# è´¡çŒ®æŒ‡å—

æ‚¨å¥½, éå¸¸æ„Ÿè°¢æ‚¨å¯¹ [MQTT X](https://mqttx.app/zh) çš„æ”¯æŒã€‚

å¦‚æœæ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å‘ç°äº†é—®é¢˜ ğŸ› æˆ–æœ‰æ›´å¥½çš„æ„è§å’Œå»ºè®® ğŸ’¡ï¼Œéƒ½å¯ä»¥å‚è€ƒä»¥ä¸‹æ–¹æ³•ä¿®æ”¹é¡¹ç›®ä»£ç å¹¶å‚ä¸åˆ°é¡¹ç›®ä¸­ã€‚

1. Fork è¿™ä¸ªä»“åº“

2. å¦‚ä¸‹è¿è¡Œé¡¹ç›®

    ``` shell
    # å®‰è£…ä¾èµ–
    cd MQTTX
    yarn install

    # ç¼–è¯‘å’Œçƒ­åŠ è½½ä»¥è¿›è¡Œå¼€å‘
    yarn run electron:serve

    # ç¼–è¯‘å¹¶å‹ç¼©ä»£ç æ‰“åŒ…æˆå®‰è£…åŒ…
    yarn run electron:build
    ```

3. æ·»åŠ  Git çš„ upstream remote

    ```shell
    git remote add upstream git@github.com:emqx/MQTTX.git`
    ```

4. å¯ä»¥å‚è€ƒä»¥ä¸‹é¡¹ç›®ç»“æ„æ¥è¿›è¡Œæºç ä¿®æ”¹:

    ```shell
    src
      â”œâ”€â”€ App.vue       # ä¸»è§†å›¾ç»„ä»¶
      â”œâ”€â”€ api           # è¯·æ±‚æ•°æ®çš„ API é›†åˆ
      â”œâ”€â”€ assets        # èµ„æº
      â”‚Â Â  â”œâ”€â”€ font
      â”‚Â Â  â”œâ”€â”€ images
      â”‚Â Â  â””â”€â”€ scss
      â”œâ”€â”€ background.ts # ä¸»è¿›ç¨‹æ–‡ä»¶
      â”œâ”€â”€ components    # å…¬ç”¨ç»„ä»¶çš„é›†åˆ
      â”œâ”€â”€ database      # æ•°æ®åº“çš„é…ç½®æ–‡ä»¶
      â”œâ”€â”€ lang          # å›½é™…åŒ–é…ç½®æ–‡ä»¶
      â”œâ”€â”€ main          # æ“ä½œä¸»è¿›ç¨‹çš„ä»£ç 
      â”œâ”€â”€ main.ts       # ä¸»æ¸²æŸ“è¿›ç¨‹çš„æ–‡ä»¶
      â”œâ”€â”€ plugins       # æ‰©å±• Vue çš„æ’ä»¶
      â”œâ”€â”€ router        # è§†å›¾è·¯ç”±çš„é…ç½®é›†åˆ
      â”œâ”€â”€ store         # Vuex çŠ¶æ€ç®¡ç†çš„é…ç½®é›†åˆ
      â”œâ”€â”€ types         # ç±»å‹å®šä¹‰çš„é›†åˆ
      â”œâ”€â”€ utils         # é€šç”¨å·¥å…·çš„é›†åˆ
      â””â”€â”€ views         # è§†å›¾ä»£ç çš„é›†åˆ
          â”œâ”€â”€ Home.vue
          â”œâ”€â”€ about
          â”œâ”€â”€ connections
          â”œâ”€â”€ log
          â”œâ”€â”€ script
          â”œâ”€â”€ settings
          â””â”€â”€ window
    ```

5. åœ¨æ–°åˆ†æ”¯ä¸Šæ·»åŠ ä¸€ä¸ª commitï¼Œå¹¶å°†å…¶æ¨é€ã€‚è¯·å‚é˜…ä»¥ä¸‹è¯´æ˜æ¥ç¼–å†™æäº¤æ—¶ commit ä¿¡æ¯çš„è§„èŒƒï¼š

    - åŸºç¡€æ ¼å¼

    `<type>(<scope>): <subject>`

    `type` è¡¨ç¤ºæäº¤çš„ç±»å‹, `scope` è¡¨ç¤ºæäº¤ä¿®æ”¹çš„èŒƒå›´ï¼Œ`subject` è¡¨ç¤ºä¸»è¦æè¿°å†…å®¹ã€‚

    ä¾‹å­:

    ```shell
    git commit -m "fix(index.vue): fix the mqtt connect bug"
    ```

    - ç±»å‹
      - feat: æ–°åŠŸèƒ½ (feature)
      - fix: ä¿®è¡¥ bug
      - refactor: é‡æ„ æ—¢ä¸æ˜¯ä¿®è¡¥ bug ä¹Ÿä¸æ˜¯æ–°åŠŸèƒ½
      - style: ä¿®æ”¹æ ·å¼ ä»£ç æ ¼å¼
      - docs: æ–‡æ¡£
      - perf: æ€§èƒ½
      - revert: æ¢å¤åŸçŠ¶
      - test: å¢åŠ æµ‹è¯•
      - ci: æŒç»­é›†æˆ
      - build || chore: æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨

6. æœ€åï¼Œå‘ä¸Šæ¸¸ä»“åº“ä¸­çš„ `master` åˆ†æ”¯å‘èµ·ä¸€ä¸ª pull request è¯·æ±‚ï¼Œæˆ‘ä»¬å°†å¯¹å…¶è¿›è¡Œè®¤çœŸçš„å®¡æŸ¥ã€‚

    > æ³¨æ„ï¼šmaster åˆ†æ”¯ä¸ºä¸ç¨³å®šä»£ç åˆ†æ”¯ï¼Œæ–°çš„ä»£ç éƒ½ä¼š merge åˆ° masterï¼Œå¦‚æœæ‚¨éœ€è¦ä½¿ç”¨ç¨³å®šä»£ç ï¼Œå¯ä»¥åˆ‡æ¢åˆ°å¯¹åº”çš„ tagã€‚git checkout ${tag_name}

7. å‘ç‰ˆæµç¨‹ï¼Œæ‹‰ä¸‹æœ€æ–°çš„ä¸»åˆ†æ”¯ `maste`ï¼Œä½¿ç”¨ä¸‹é¢è¿™ä¸ªå‘½ä»¤è¡Œäº§ç”Ÿä¸€ä¸ªæ–°çš„ commitï¼Œæœ€åä½¿ç”¨ rebase merge åˆå¹¶åˆ°ä¸»åˆ†æ”¯ `master`ã€‚

    ```shell
    npm version [patch | minor | major] -m '${Commit message}'
    ```

è°¢è°¢æ‚¨çš„è€å¿ƒé˜…è¯»ï¼å¹¶æ„Ÿè°¢æ‚¨å¯¹ MQTT X çš„è´¡çŒ®ï¼:)

## æ•°æ®åº“è¿ç§»

å¦‚æœæ•°æ®åº“æ¨¡å‹å‘ç”Ÿå˜åŒ–ï¼Œè¯·ä»”ç»†é˜…è¯»æœ¬èŠ‚å†…å®¹ã€‚

ä»¥ä¸‹å‘½ä»¤å¯ä»¥å®‰å…¨ä½¿ç”¨

```shell
# å±•ç¤ºè¿è¡Œ db:sync åå°†è¦æ‰§è¡Œçš„ SQL å‘½ä»¤
yarn run db:log

# å±•ç¤ºå½“å‰å“ªäº›è¿ç§»ä»»åŠ¡éœ€è¦è¿è¡Œæˆ–æ˜¯è¿˜æœªè¿è¡Œ
yarn run db:migration:show

# æ ¹æ®å½“å‰çš„æ¨¡å‹å®šä¹‰ï¼Œè‡ªåŠ¨ç”Ÿæˆæ–°æ•°æ®åº“æ¨¡å‹çš„è¿ç§»æ–‡ä»¶
yarn run db:migration:generate -n ${migration_name}

# ç”Ÿæˆæ•°æ®æ¨¡å‹ ER å›¾
yarn run db:diagram
```

ä»¥ä¸‹æ˜¯å±é™©çš„å‘½ä»¤ï¼Œå°†ä¼šå½±å“æ•°æ®åº“æ•°æ®

```shell
# å±é™©ï¼Œåªå¯ä»¥åœ¨å¼€å‘ç¯å¢ƒä¸‹ä½¿ç”¨ï¼
# ç›´æ¥åŒæ­¥å½“å‰çš„æ•°æ®æ¨¡å‹åˆ°æ•°æ®åº“
yarn run db:migration:sync

# æ‰§è¡Œæˆ–è€…å›æ»šå½“å‰çš„æ•°æ®åº“è¿ç§»æ–‡ä»¶
yarn run db:migration:[run|revert]
```

å¦‚æœä½ æ­£å¤„äºå¼€å‘æ¨¡å¼ï¼Œå¹¶ä¸”åœ¨æ•°æ®åº“ä¸­æ²¡æœ‰å®é™…çš„æ•°æ®ï¼Œé‚£ä¹ˆä½ å¯ä»¥æ”¾å¿ƒåœ°æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤åŒæ­¥

1. `yarn run db:migration:drop` (å¯é€‰çš„) åˆ é™¤æ‰€æœ‰è¡¨æ ¼
2. `yarn run db:log` (å¯é€‰çš„) ç”¨äºç¡®å®šå½“å‰è¿ç§»å°†ä¼šæ‰§è¡Œçš„ SQL è¯­å¥
3. `db:migration:sync` åŒæ­¥æ•°æ®æ¨¡å‹åˆ°æ•°æ®åº“
4. `yarn run db:diagram` (å¯é€‰çš„) ç”Ÿæˆä¸€ä¸ªæœ€æ–°çš„ ER å…³ç³»å›¾

å¦åˆ™ï¼Œä½ åº”è¯¥éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼Œå¹¶ä¸”çŸ¥é“ä½ æ­£åœ¨åšçš„æ¯ä¸€æ­¥åœ¨å¹²ä»€ä¹ˆï¼Œå¦åˆ™å°†ä¼šæœ‰å¤±å»æ•°æ®åº“çš„é£é™©ã€‚

1. `yarn run db:log` (å¯é€‰çš„) ç”¨äºç¡®å®šå½“å‰è¿ç§»å°†ä¼šæ‰§è¡Œçš„ SQL è¯­å¥
2. `db:migration:generate -n {migration_name}` è‡ªåŠ¨ç”Ÿæˆè¿ç§»è„šæœ¬
3. `db:migration:run` è¿è¡Œè¿ç§»è„šæœ¬ã€‚åœ¨ç‰ˆæœ¬æ›´æ–°æ—¶åº”è¯¥æœ¬åœ°è¿è¡Œè¯¥è¿ç§»è„šæœ¬
4. `db:diagram` (å¯é€‰çš„) ç”Ÿæˆä¸€ä¸ªæœ€æ–°çš„ ER å…³ç³»å›¾

è¯·ä½¿ç”¨ `db:migration:revert` å‘½ä»¤æ’¤å›ä¸Šä¸€æ¬¡è¿ç§», æ‰§è¡Œ `db:migration:drop`, `db:migration:sync` å‘½ä»¤æ—¶è¯·å½“å¿ƒ.

å‚è€ƒ:

- [typeorm migrations](https://github.com/typeorm/typeorm/blob/master/docs/migrations.md#creating-a-new-migration)
- [typeorm CLI](https://github.com/typeorm/typeorm/blob/master/docs/using-cli.md#installing-cli)
